(()=>{"use strict";var e=document.querySelector(".card__edit-button"),t=document.querySelector(".card__add-button"),o=document.querySelector(".popup-profile"),n=document.querySelector(".popup-add"),r=document.querySelector(".popup-open-img"),c=document.querySelector('[name="Name"]'),a=document.querySelector(".card__title"),u=document.querySelector('[name="Job"]'),i=document.querySelector(".card__subtitle"),s=document.querySelector('[name="add-card"]'),d=document.querySelectorAll(".popup__close-icon"),l=document.querySelector('[name="edit-profile"]'),f=document.querySelector('[name="CardName"]'),p=document.querySelector('[name="Link"]'),m=(document.querySelector(".element__title"),document.querySelector("#card"),document.querySelector(".elements")),_=document.querySelector("#card").content,v=document.querySelector(".popup__opened-img"),h=document.querySelector(".popup__img-title"),y=document.querySelectorAll(".popup__save-button"),S=document.querySelector("#form-profile-save"),q=document.querySelector("#form-add-card-save"),L=(document.querySelector(".element__numberOfLikes"),document.querySelector(".element__basket"),document.querySelector(".popup__basket-button")),b=document.querySelector(".card__avatar-edit"),k=document.querySelector(".popup__edit-img"),C=document.querySelector('[name="edit-img"]'),E=document.querySelector('[name="Img-link"]'),g=document.querySelector(".card__avatar"),x=document.querySelector(".popup__basket"),j=function(e,t,o,n,c,a,u){m.prepend(function(e,t,o,n,c,a,u,i){var s=u.querySelector(".element").cloneNode(!0),d=s.querySelector(".element__mask-group");s.querySelector(".element__title").textContent="".concat(t),s.querySelector(".element__numberOfLikes").textContent="".concat(o),d.src="".concat(e),d.alt="".concat(t),d.addEventListener("click",(function(){A(r),v.src="".concat(e),v.alt="".concat(t),h.textContent="".concat(t)}));var l=s.querySelector(".element__group"),f=s.querySelector(".element__basket");fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me",{headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){JSON.stringify(a).includes(e._id)&&l.classList.add("element__group_active"),c===e._id&&f.classList.add("element__basket_my")})).catch((function(e){console.log(e)}));var p,m=s.querySelector(".element__basket"),_=s.querySelector(".element__numberOfLikes");return _.textContent="".concat(o),m.addEventListener("click",(function(){A(x),p="".concat(n)})),L.addEventListener("click",(function(){!function(e){fetch("https://nomoreparties.co/v1/plus-cohort-24/cards/".concat(e),{method:"DELETE",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"}}),fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me",{headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){c===e._id&&s.closest(".element").remove()})).catch((function(e){console.log(e)})),T(x)}(p)})),l.addEventListener("click",(function(){var e=_.textContent;function t(e){fetch("https://nomoreparties.co/v1/plus-cohort-24/cards/".concat(e,"/likes"),{method:"PUT",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"}})}l.classList.contains("element__group_active")?s.querySelector(".element__numberOfLikes").textContent=e-1:s.querySelector(".element__numberOfLikes").textContent=e- -1,l.classList.toggle("element__group_active"),t(p="".concat(n)),function(e){fetch("https://nomoreparties.co/v1/plus-cohort-24/cards/".concat(e,"/likes"),{method:"DELETE",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"}})}(p),t(p)})),s}(e,t,o,n,c,a,_))},z=function(e){e.target.classList.contains("popup_opened")&&T(document.querySelector(".popup_opened"))};function A(e){e.classList.add("popup_opened"),document.addEventListener("mousedown",z),document.addEventListener("keydown",O)}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("mousedown",z),document.removeEventListener("keydown",O)}function O(e){"Escape"===e.key&&T(document.querySelector(".popup_opened"))}var N,w=function(e){var t=Array.from(e.querySelectorAll(".form__input-error")),o=Array.from(e.querySelectorAll(".form__input_type_error"));t.forEach((function(e){e.textContent=""})),o.forEach((function(e){e.classList.remove("form__input_type_error")}))},B=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))};function J(e){e&&(y.textContent="Сохранение...")}fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me",{headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){g.src=e.avatar,g.alt="аватар"})).catch((function(e){console.log(e)})),fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me",{headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){a.textContent=e.name,i.textContent=e.about})),fetch("https://nomoreparties.co/v1/plus-cohort-24/cards",{headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){e.reverse(),e.forEach((function(e){j(e.link,e.name,e.likes.length,e._id,e.owner._id,e.likes)}))})).catch((function(e){console.log(e)})),C.addEventListener("submit",(function(){J(!0),fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me/avatar ",{method:"PATCH",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"},body:JSON.stringify({avatar:E.value})}),g.src=E.value,T(k)})),b.addEventListener("click",(function(){A(k)})),d.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return T(t)}))})),N={formSelector:".form",inputSelector:".popup__label",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(N.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);B(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),B(o,n,t)}))}))}(e,N)})),e.addEventListener("click",(function(){A(o),fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me",{headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1"}}).then((function(e){if(e.ok)return e.json()})).then((function(e){c.value=e.name,u.value=e.about})),w(o)})),t.addEventListener("click",(function(){A(n),s.reset(),w(n)})),v.addEventListener("click",(function(){A(r)})),l.addEventListener("submit",(function(e){J(!0),fetch("https://nomoreparties.co/v1/plus-cohort-24/users/me",{method:"PATCH",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"},body:JSON.stringify({name:c.value,about:u.value})}),a.textContent=c.value,i.textContent=u.value,T(o),S.classList.add("popup__save-button_inactive"),S.disabled=!0})),s.addEventListener("submit",(function(e){e.preventDefault(),fetch("https://nomoreparties.co/v1/plus-cohort-24/cards",{method:"POST",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"},body:JSON.stringify({name:f.value,link:p.value})});var t=f.value,o=p.value;j(o,t,0),s.reset(),T(n),q.classList.add("popup__save-button_inactive"),q.disabled=!0}))})();