(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{x:()=>F});var t=document.querySelector(".card__edit-button"),n=document.querySelector(".card__add-button"),r=document.querySelector(".popup-profile"),o=document.querySelector(".popup-add"),c=document.querySelector(".popup-open-img"),a=document.querySelector('[name="Name"]'),u=document.querySelector(".card__title"),i=document.querySelector('[name="Job"]'),s=document.querySelector(".card__subtitle"),d=document.querySelector('[name="add-card"]'),l=document.querySelectorAll(".popup__close-icon"),m=document.querySelector('[name="edit-profile"]'),p=document.querySelector('[name="CardName"]'),_=document.querySelector('[name="Link"]'),f=(document.querySelector(".element__title"),document.querySelector("#card"),document.querySelector(".elements")),v=document.querySelector("#card").content,y=document.querySelector(".popup__opened-img"),S=document.querySelector(".popup__img-title"),h=(document.querySelectorAll(".popup__save-button"),document.querySelector("#form-profile-save")),b=document.querySelector("#form-add-card-save"),q=(document.querySelector(".element__numberOfLikes"),document.querySelector(".element__basket"),document.querySelector(".popup__basket-button")),L=document.querySelector(".card__avatar-edit"),k=document.querySelector(".popup__edit-img"),E=document.querySelector('[name="edit-img"]'),g=document.querySelector('[name="Img-link"]'),C=document.querySelector(".card__avatar"),x=document.querySelector('[name="edit-img"]'),U=document.querySelector(".save-button-img"),A=document.querySelector("#form-add-img"),O=document.querySelector(".save-button-edit"),w=document.querySelector(".save-button-add");function N(e,t){return fetch(e,t).then(P)}function P(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var T,j={baseUrl:"https://nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"caadd57f-8e95-4623-a4c1-d6d937fceff1","Content-Type":"application/json"}},B=document.querySelector(".popup__basket"),J=function(e,t,n,r,o,a,u){f.prepend(function(e,t,n,r,o,a,u){var i=u.querySelector(".element").cloneNode(!0),s=i.querySelector(".element__mask-group");i.querySelector(".element__title").textContent="".concat(t),i.querySelector(".element__numberOfLikes").textContent="".concat(n),s.src="".concat(e),s.alt="".concat(t),s.addEventListener("click",(function(){M(c),y.src="".concat(e),y.alt="".concat(t),S.textContent="".concat(t)}));var d=i.querySelector(".element__group"),l=i.querySelector(".element__basket");N("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then((function(e){JSON.stringify(a).includes(e._id)&&d.classList.add("element__group_active")})),o===F&&l.classList.add("element__basket_my");var m=i.querySelector(".element__basket"),p=i.querySelector(".element__numberOfLikes"),_="".concat(r);return m.addEventListener("click",(function(){M(B),T="".concat(r)})),d.addEventListener("click",(function(){var e;d.classList.contains("element__group_active")?(e=_,N("".concat(j.baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:j.headers}).then((function(e){var t=e.likes.length;p.textContent="".concat(t)}))):function(e){N("".concat(j.baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:j.headers}).then((function(e){var t=e.likes.length;p.textContent="".concat(t)}))}(_),d.classList.toggle("element__group_active")})),i}(e,t,n,r,o,a,v))};q.addEventListener("click",(function(){var e;e=T,N("".concat(j.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:j.headers}).then((function(e){H(B),N("".concat(j.baseUrl,"/cards"),{headers:j.headers}).then((function(e){e.reverse(),e.forEach((function(e){J(e.link,e.name,e.likes.length,e._id,e.owner._id,e.likes)}))}))}))}));var D=function(e){e.target.classList.contains("popup_opened")&&H(document.querySelector(".popup_opened"))};function M(e){e.classList.add("popup_opened"),document.addEventListener("mousedown",D),document.addEventListener("keydown",V)}function H(e){e.classList.remove("popup_opened"),document.removeEventListener("mousedown",D),document.removeEventListener("keydown",V)}function V(e){"Escape"===e.key&&H(document.querySelector(".popup_opened"))}var z=function(e){var t=Array.from(e.querySelectorAll(".form__input-error")),n=Array.from(e.querySelectorAll(".form__input_type_error"));t.forEach((function(e){e.textContent=""})),n.forEach((function(e){e.classList.remove("form__input_type_error")}))};function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t.textContent=e?r:n}var F,G=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};N("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then((function(e){u.textContent=e.name,s.textContent=e.about,C.src=e.avatar,C.alt="аватар",F=e._id})),N("".concat(j.baseUrl,"/cards"),{headers:j.headers}).then((function(e){e.reverse(),e.forEach((function(e){J(e.link,e.name,e.likes.length,e._id,e.owner._id,e.likes)}))})),L.addEventListener("click",(function(){M(k),x.reset(),z(k)})),l.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return H(t)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);G(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),G(n,r,t)}))}))}(t,e)}))}({formSelector:".form",inputSelector:".popup__label",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}),t.addEventListener("click",(function(){M(r),z(r),N("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then((function(e){a.value=e.name,i.value=e.about}))})),n.addEventListener("click",(function(){M(o),d.reset(),z(o)})),y.addEventListener("click",(function(){M(c)})),m.addEventListener("submit",(function(e){I(!0,O),N("".concat(j.baseUrl,"/users/me"),{method:"PATCH",headers:j.headers,body:JSON.stringify({name:a.value,about:i.value})}).finally((function(){I(!1,O),H(r)})),u.textContent=a.value,s.textContent=i.value,h.classList.add("popup__save-button_inactive"),h.disabled=!0})),d.addEventListener("submit",(function(e){e.preventDefault(),I(!0,w),N("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.headers,body:JSON.stringify({name:p.value,link:_.value})}).then((function(e){J(e.link,e.name,e.likes.length,e._id,e.owner._id,e.likes)})).finally((function(){I(!1,w),H(o)})),d.reset(),b.classList.add("popup__save-button_inactive"),b.disabled=!0})),E.addEventListener("submit",(function(){I(!0,U),N("".concat(j.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:j.headers,body:JSON.stringify({avatar:g.value})}).then((function(e){C.src=g.value})).finally((function(){I(!1,U),H(k),x.reset(),A.classList.add("popup__save-button_inactive"),A.disabled=!0}))}))})();